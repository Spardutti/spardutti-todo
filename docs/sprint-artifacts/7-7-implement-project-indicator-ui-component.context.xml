<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>7</epicId>
    <storyId>7</storyId>
    <title>Implement Project Indicator UI Component</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-26</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/7-7-implement-project-indicator-ui-component.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>to see which project is currently active</iWant>
    <soThat>I know where my todos are being added</soThat>
    <tasks>
      <task id="1" ac="7">Create projectIndicator.ts file structure
        <subtask>Create new file at src/ui/projectIndicator.ts</subtask>
        <subtask>Import Project type from @/types/Project</subtask>
        <subtask>Define function signature for renderProjectIndicator</subtask>
        <subtask>Export the function</subtask>
      </task>
      <task id="2" ac="1,5">Implement DOM structure for indicator
        <subtask>Create container element (div or span)</subtask>
        <subtask>Add project name text node</subtask>
        <subtask>Add dropdown arrow span with character</subtask>
        <subtask>Set data attribute for project id (data-project-id)</subtask>
      </task>
      <task id="3" ac="2,6">Apply terminal styling
        <subtask>Set inline styles or CSS class for green text (#00FF00)</subtask>
        <subtask>Set font: Consolas, monospace at 14px</subtask>
        <subtask>Set background: transparent</subtask>
        <subtask>Set cursor: pointer</subtask>
        <subtask>Add hover state styling (#001100 background)</subtask>
        <subtask>Handle long project names with text-overflow: ellipsis</subtask>
        <subtask>Set max-width for truncation</subtask>
      </task>
      <task id="4" ac="3">Implement click handling
        <subtask>Add click event listener to indicator element</subtask>
        <subtask>Call onDropdownClick callback when clicked</subtask>
        <subtask>Prevent event propagation if needed</subtask>
        <subtask>Ensure entire indicator (name + arrow) is clickable</subtask>
      </task>
      <task id="5" ac="7">Implement container clearing
        <subtask>Clear container innerHTML before rendering</subtask>
        <subtask>Append new indicator element to container</subtask>
        <subtask>Ensure idempotent behavior (can call repeatedly)</subtask>
      </task>
      <task id="6" ac="2">Add CSS styles to styles.css
        <subtask>Add .project-indicator class styles</subtask>
        <subtask>Add .project-indicator:hover state</subtask>
        <subtask>Add .project-indicator-name for name span</subtask>
        <subtask>Add .project-indicator-arrow for dropdown arrow</subtask>
        <subtask>Follow terminal aesthetic constraints (no transitions)</subtask>
      </task>
      <task id="7" ac="4">Implement update mechanism
        <subtask>Ensure renderProjectIndicator can be called with new project</subtask>
        <subtask>Test that calling with different project updates display</subtask>
        <subtask>Verify no stale data after project switch</subtask>
      </task>
      <task id="8" ac="7">Unit tests
        <subtask>Create src/ui/projectIndicator.test.ts</subtask>
        <subtask>Test: renders project name correctly</subtask>
        <subtask>Test: renders dropdown arrow</subtask>
        <subtask>Test: click triggers callback</subtask>
        <subtask>Test: updates when called with different project</subtask>
        <subtask>Test: clears container before rendering</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Project indicator component displays current project name:
      - Shows the active project's name
      - Displays dropdown arrow to indicate clickable
      - Location: Header/footer area of the app</criterion>
    <criterion id="2">Visual styling matches terminal aesthetic:
      - Color: #00FF00 (bright terminal green)
      - Font: Consolas 14px monospace (matching app font)
      - Background: transparent (inherit black)
      - Hover state: subtle #001100 tint (dark green)
      - No animations or transitions (instant state changes)</criterion>
    <criterion id="3">Project indicator is clickable:
      - Click triggers onDropdownClick callback
      - Cursor changes to pointer on hover
      - Click area covers entire indicator (name + arrow)</criterion>
    <criterion id="4">Component updates when project changes:
      - Indicator re-renders when active project switches
      - Name updates immediately after project selection
      - No stale data displayed</criterion>
    <criterion id="5">Dropdown arrow provides visual affordance:
      - Unicode character: U+25BC BLACK DOWN-POINTING TRIANGLE
      - Small gap between name and arrow
      - Arrow is same color as name (#00FF00)</criterion>
    <criterion id="6">Indicator has minimal footprint:
      - Doesn't dominate the UI
      - Compact display that fits in header/footer
      - Truncation if project name is very long (with ellipsis)</criterion>
    <criterion id="7">Component exports function:
      - renderProjectIndicator(project: Project, container: HTMLElement, onDropdownClick: () => void): void
      - Clears container before rendering (idempotent)
      - Attaches click handler to indicator element</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/architecture.md" title="Architecture" section="Project Search UI Pattern">
        Defines visual design for project indicator: header/footer location, dropdown arrow,
        terminal aesthetic. Shows ASCII mockup of indicator with "[SequenceStack ▼]" pattern.
      </doc>
      <doc path="docs/architecture.md" title="Architecture" section="Implementation Patterns">
        Terminal Aesthetic Enforcement: Font Consolas 14px, Colors Matrix Green palette only
        (#00FF00, #004400, #008800, #000000), no animations, no modals, borders 1px solid green.
      </doc>
      <doc path="docs/architecture.md" title="Architecture" section="FR Category Mapping">
        FR34 maps to projectIndicator.ts at src/ui/. Component shows active project indicator.
      </doc>
      <doc path="docs/ux-design-specification.md" title="UX Design" section="Color System">
        Matrix Green palette: --color-text-primary: #00FF00, --color-bg-primary: #000000,
        hover state: #001100 (subtle dark green tint).
      </doc>
      <doc path="docs/sprint-artifacts/tech-spec-epic-7.md" title="Tech Spec Epic 7" section="FR34 Active Project Indicator">
        Acceptance criteria: current project name visible, dropdown arrow indicates clickable,
        updates immediately on project switch, styled with terminal green on black.
      </doc>
      <doc path="docs/sprint-artifacts/tech-spec-epic-7.md" title="Tech Spec Epic 7" section="Components Affected">
        projectIndicator (new) at src/ui/projectIndicator.ts - Header/footer project name + dropdown.
      </doc>
      <doc path="docs/epics.md" title="Epics" section="Story 7.7">
        Original story requirements with function signature: renderProjectIndicator(project, container, onDropdownClick).
      </doc>
    </docs>
    <code>
      <file path="src/types/Project.ts" kind="type" symbol="Project" reason="Import Project interface for function parameter typing">
        interface Project { id: string; name: string; createdAt: string }
      </file>
      <file path="src/ui/render.ts" kind="module" symbol="renderTodoItem, renderApp" lines="45-199" reason="Reference patterns for DOM creation, event handling, container clearing, accessibility attributes">
        Shows existing patterns: createElement, className assignment, setAttribute for ARIA,
        appendChild, focus management, footer structure with hints.
      </file>
      <file path="src/ui/styles.css" kind="styles" symbol="CSS variables, .todo-item" lines="1-244" reason="CSS patterns for terminal aesthetic, hover states, color variables">
        Contains :root CSS variables, hover state patterns (#001100), flex layout patterns,
        dense spacing (0.35rem), cursor: pointer for clickable elements.
      </file>
    </code>
    <dependencies>
      <node>
        <package name="typescript" version="~5.9.2" purpose="Type checking and compilation" />
        <package name="vitest" version="^4.0.13" purpose="Unit testing framework" />
        <package name="jsdom" version="^27.2.0" purpose="DOM simulation for tests" />
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint source="architecture.md">Terminal Aesthetic: Consolas monospace 14px, no exceptions</constraint>
    <constraint source="architecture.md">Colors: Matrix Green palette ONLY (#00FF00, #004400, #008800, #000000)</constraint>
    <constraint source="architecture.md">No animations or transitions (instant state changes)</constraint>
    <constraint source="architecture.md">No modals or overlays (inline UI only)</constraint>
    <constraint source="architecture.md">Borders: 1px solid green (#00FF00)</constraint>
    <constraint source="CLAUDE.md">Use arrow functions, functions should read like sentences</constraint>
    <constraint source="CLAUDE.md">Use objects for parameters (function signature uses object param)</constraint>
    <constraint source="CLAUDE.md">Functions should have at most 20 lines</constraint>
    <constraint source="story">Direct DOM manipulation (no virtual DOM framework)</constraint>
    <constraint source="story">Pure function with no side effects beyond DOM manipulation</constraint>
    <constraint source="story">Dropdown functionality will be implemented in Story 7.9 (not this story)</constraint>
  </constraints>

  <interfaces>
    <interface name="renderProjectIndicator" kind="function" path="src/ui/projectIndicator.ts">
      <signature>
        export const renderProjectIndicator = ({
          project,
          container,
          onDropdownClick
        }: {
          project: Project
          container: HTMLElement
          onDropdownClick: () =&gt; void
        }): void
      </signature>
      <description>Renders active project indicator with name and dropdown arrow into container</description>
    </interface>
    <interface name="Project" kind="type" path="src/types/Project.ts">
      <signature>interface Project { id: string; name: string; createdAt: string }</signature>
      <description>Project data model for indicator display</description>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Unit tests use Vitest framework with jsdom for DOM simulation. Co-located test files
      (*.test.ts in same directory as source). Follow existing patterns in TodoStore.test.ts.
      Test pure functions with clear assertions, mock DOM elements using jsdom environment.
    </standards>
    <locations>
      <location>src/ui/projectIndicator.test.ts</location>
      <location>src/store/*.test.ts (reference patterns)</location>
      <location>src/types/*.test.ts (reference patterns)</location>
    </locations>
    <ideas>
      <idea ac="1">Test that project name is rendered as text content in indicator</idea>
      <idea ac="5">Test that dropdown arrow character (▼) is present in indicator</idea>
      <idea ac="3">Test that click event on indicator calls onDropdownClick callback</idea>
      <idea ac="4">Test that calling render with different project updates displayed name</idea>
      <idea ac="7">Test that container is cleared before rendering (idempotent behavior)</idea>
      <idea ac="2">Test that indicator element has correct CSS class applied</idea>
      <idea ac="6">Test that data-project-id attribute is set correctly</idea>
      <idea edge="true">Test with empty project name (edge case)</idea>
      <idea edge="true">Test with very long project name (truncation)</idea>
    </ideas>
  </tests>
</story-context>
